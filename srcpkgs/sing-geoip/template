# Template file for 'sing-geoip'
pkgname=sing-geoip
version=20240212
revision=1
build_style=go
build_helper=qemu
go_import_path="github.com/sagernet/sing-geoip"
short_desc="Geoip database and rule sets for sing-box"
maintainer="Nuckle <coil@itscat.org>"
license="GPL-3.0-or-later, LGPL-3.0-or-later"
homepage="https://github.com/SagerNet/sing-geoip"
changelog="https://github.com/SagerNet/sing-geoip/releases"
distfiles="https://github.com/SagerNet/sing-geoip/archive/refs/tags/${version}.tar.gz"
checksum=9c45705de8bff9ac875a332e5b2dc26b5658414f2da75b69e7e306931e6c1308

post_build() {
	for f in ${GOPATH}/bin/* ${GOPATH}/bin/**/*; do
		if [ -f "$f" ] && [ -x "$f" ]; then
			NO_SKIP=true vtargetrun "$f"
		fi
	done
}

do_install() {
	vmkdir usr/share/sing-geoip
	vmkdir usr/share/sing-geoip/rule-set

	vcopy rule-set/* usr/share/sing-geoip/rule-set
	vcopy *.db usr/share/sing-geoip
}
